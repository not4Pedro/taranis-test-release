name: Release on pushed tags

on:
  push:
    tags:
      - '*'
  # TODO: remove
  pull_request:

jobs:
  release:
    runs-on: ubuntu-22.04
    # TODO: remove
    env:
      tag: test.0.9.2

    steps:
      - name: Checkout
        uses: actions/checkout@v4
      # TODO: uncomment
      # - name: Get tag name
      #   run: echo "tag=${GITHUB_REF#refs/tags/}" >> $GITHUB_ENV

      - name: Update env.sample
        run: |
          cp docker/env.sample ${{ runner.temp }}
          sed -i 's/^TARANIS_TAG=.*/TARANIS_TAG=${{ env.tag }}/' ${{ runner.temp }}/env.sample
      
      - name: Create tar.gz of repository
        uses: a7ul/tar-action@v1.2.0
        id: compress
        with:
          command: c
          files: .
          outPath: ${{ runner.temp }}/${{ env.tag }}.tar.gz

      - name: Create zip of repository
        run: zip -r "${{ runner.temp }}/${{ env.tag }}.zip" .


      - name: Verify changes
        run: |
          echo "Tag: ${{ env.tag }}"
          cat ${{ runner.temp }}/env.sample
          ls -l "${{ runner.temp }}/${{ env.tag }}.zip"
          ls -l "${{ runner.temp }}/${{ env.tag }}.tar.gz"

      # - name: Release
      #   uses: softprops/action-gh-release@v2
      #   if: startsWith(github.ref, 'refs/tags/')
      #   with:
      #     tag_name: ${{ env.tag }}
      #     release_name: ${{ env.tag }}
      #     body: ${{ github.event.head_commit.message }}
      #     files: |
      #       dokcer/env.sample
      #       docker/compose.yml
      #       "${{ env.tag }}.zip"
      #       "${{ env.tag }}.tar.gz"
